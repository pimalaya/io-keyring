name: Run examples

on:
  push:

jobs:
  examples:
    runs-on: ${{ matrix.os }}
    strategy:
      fail-fast: false
      matrix:
        include:
          - os: ubuntu-latest
            features: ss-dbus-std,ss-dbus-openssl-std
            example: ss-dbus-openssl-std
          - os: macos-13
            features: apple-native-std
            example: apple-native-std
          - os: macos-14
            features: apple-native-std
            example: apple-native-std
          - os: macos-15
            features: apple-native-std
            example: apple-native-std
          - os: macos-13
            features: apple-native-std
            example: apple-native-std
          - os: windows-latest
            features: windows-native-std
            example: windows-native-std
    steps:
      - uses: actions/checkout@v4
      - uses: awalsh128/cache-apt-pkgs-action@latest
        if: matrix.os == 'ubuntu-latest'
        with:
          packages: libdbus-1-dev
      - uses: actions-rust-lang/setup-rust-toolchain@v1
      - run: cargo run --features ${{ matrix.features }} --example ${{ matrix.example }}
